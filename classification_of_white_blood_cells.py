"""BloodCellnew.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1L-ZeNID-o0D_dRvUH_lUUltahflYfiGz

#Selecting a random percentage of 10% of the files from each class based on the number of files in the training set for the validation files
"""

import os
import shutil
import random

def move_random_files(source_folder, target_folder, number_of_files):
    # Kaynak klasördeki tüm dosyaları listelemesi için
    all_files = os.listdir(source_folder)

    # Dosya sayısını kontrol etmek için
    if len(all_files) < number_of_files:
        print(f"Hata: Kaynak klasörde {number_of_files} adetten daha az dosya var.")
        return

    # Hedef klasör yoksa oluştur
    if not os.path.exists(target_folder):
        os.makedirs(target_folder)

    # Rastgele dosyaları seçer
    random_files = random.sample(all_files, number_of_files)

    # Seçilen dosyaları taşır
    for file_name in random_files:
        source_path = os.path.join(source_folder, file_name)
        target_path = os.path.join(target_folder, file_name)
        try:
            shutil.move(source_path, target_path)
            print(f"Taşındı: {source_path} -> {target_path}")
        except Exception as e:
            print(f"Hata oluştu: {file_name} -> {e}")

# Kullanım örneği
source_directory = "/Users/batuhankilicarslan/Desktop/bloodcells_dataset/DATA/train"  # Kaynak klasör yolu
target_directory = "/Users/batuhankilicarslan/Desktop/bloodcells_dataset/DATA/val"  # Hedef klasör yolu
move_random_files(source_directory, target_directory, 122)

"""#Code to Install Libraries"""

# Ultralytics YOLO ve PyTorch kütüphanelerini yükleme kodu
!pip install ultralytics
!pip install torch

"""# Training"""

import os # Dosya ve dizin işlemleri için gerekli modül
from ultralytics import YOLO  # YOLO modeli için ultralytics kütüphanesi
import torch  # PyTorch kütüphanesi; tensor işlemleri ve GPU kullanımı için

# GPU kullanımı kontrolü: CUDA mevcutsa cuda, değilse cpu kullanması için
device = 'cuda' if torch.cuda.is_available() else 'cpu'

# Veri setinin bulunduğu path
DATA_DIR = "/content/drive/MyDrive/bloodcellProject/Data.b"

# YOLO sınıflandırma modeli yüklmesi; 'yolov8x-cls.pt'
model = YOLO("yolov8x-cls.pt")


# Modelin eğitimi başlatılır
results = model.train(data=DATA_DIR,  # Eğitim verilerinin dizini
                      project='/content/drive/MyDrive/bloodcellProject/runs_bloodcell', # Eğitim sonuçlarının kaydedileceği dizin
                      epochs=5, # Eğitim döngüsü sayısı (epoch)
                      auto_augment = False, # Otomatik veri artırma (augmentation) devre dışı
                      mixup = 0,  # Veri karıştırma tekniği (mixup) devre dışı
                      shear= 0, # Görüntü kesme (shear) işlemi devre dışı
                      erasing = 0,  # Rastgele silme (random erasing) devre dışı
                      imgsz=500,  # Eğitim sırasında kullanılacak görüntü boyutu (500x500 piksel)
                      lr0=0.001,  # Başlangıç öğrenme oranı (learning rate)
                      optimizer='Adam', # Kullanılacak optimizasyon algoritması: Adam
                      cache=True) # Veri setinin önbelleğe alınması; eğitim sürecini hızlandırır
